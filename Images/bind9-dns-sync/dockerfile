FROM python:3.11-alpine

WORKDIR /app

# Install required packages
RUN apk add --no-cache \
    gcc \
    musl-dev \
    python3-dev \
    dnsutils

# Copy requirements and install Python dependencies
COPY requirements-dns-sync.txt .
RUN pip install --no-cache-dir -r requirements-dns-sync.txt

# Copy the DNS sync script
COPY dns-sync.py .

# Create log directory
RUN mkdir -p /var/log

# Run the sync script
CMD ["python3", "dns-sync.py", "--bind-server", "bind9", "--sync-on-start", "--log-level", "INFO"]
